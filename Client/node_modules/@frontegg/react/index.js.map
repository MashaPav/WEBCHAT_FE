{"version":3,"file":"index.js","sources":["../src/routerProxy.tsx","../src/queryKeeper.tsx","../src/FronteggProvider.tsx","../src/AuthorizedContent.tsx","../src/CheckoutDialog.tsx"],"sourcesContent":["import * as ReactRouterDom from 'react-router-dom';\n\nexport type Path = string;\n\ntype Location = {\n  pathname: string;\n  search: string;\n  state: any;\n  hash: string;\n  key?: string;\n};\n\ntype LocationDescriptor = string | Location;\n\nexport type UseHistory = {\n  push(path: Path, state?: any): void;\n  push(location: LocationDescriptor): void;\n  replace(path: Path, state?: any): void;\n  replace(location: LocationDescriptor): void;\n};\n\nexport const BrowserRouter = ReactRouterDom.BrowserRouter;\n\nexport const useHistory = (): UseHistory => {\n  // @ts-ignore\n  const navigate = ReactRouterDom.useInRouterContext?.() ? ReactRouterDom.useNavigate?.() : null;\n  const history = ReactRouterDom.useHistory?.();\n\n  if (navigate) {\n    const push = (path: Path, state?: any): void => {\n      if (state) {\n        navigate(path, { state });\n      } else {\n        navigate(path);\n      }\n    };\n\n    const replace = (path: Path, state?: any): void => {\n      navigate(path, { state, replace: true });\n    };\n\n    return { push, replace };\n  }\n  return history;\n};\n","import { useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { UseHistory } from './routerProxy';\n\ninterface UseQueryKeeperProps {\n  history: UseHistory;\n  routes: {\n    [key: string]: string;\n  };\n}\n\nconst removeRedirectUrlFromQuery = (query: string) => {\n  const q = new URLSearchParams(query);\n  q.delete('redirectUrl');\n  return q.toString();\n};\n\nexport const useQueryKeeper = ({ routes, history }: UseQueryKeeperProps): void => {\n  const queryParams = useRef<string>();\n  const prevPathname = useRef<string>();\n  const { pathname, search } = useLocation();\n\n  useEffect(() => {\n    if (!!search) {\n      queryParams.current = search;\n      prevPathname.current = pathname;\n    }\n  }, []);\n\n  useEffect(() => {\n    const shouldKeepQuery = !!Object.values(routes).find((route) => route === prevPathname.current);\n\n    if (!search && !!queryParams.current && shouldKeepQuery) {\n      const query = removeRedirectUrlFromQuery(queryParams.current);\n      history.push(pathname + `?${query}`);\n    }\n\n    prevPathname.current = pathname;\n  }, [pathname, search, routes]);\n};\n","import React, { FC, ReactNode, useCallback, useMemo } from 'react';\nimport { initialize } from '@frontegg/admin-portal';\nimport { FronteggAppOptions } from '@frontegg/types';\nimport { FronteggStoreProvider } from '@frontegg/react-hooks';\nimport { BrowserRouter, useHistory, UseHistory } from './routerProxy';\nimport { ContextHolder, RedirectOptions } from '@frontegg/rest-api';\nimport { AppHolder } from '@frontegg/admin-portal/AppHolder';\nimport { useQueryKeeper } from './queryKeeper';\n\nexport type FronteggProviderProps = FronteggAppOptions & {\n  appName?: string;\n  history?: UseHistory;\n  children?: ReactNode;\n};\ntype ConnectorProps = Omit<FronteggProviderProps, 'history'> & {\n  history: {\n    push: (path: string) => void;\n    replace: (path: string) => void;\n  };\n};\n\nexport const ConnectorHistory: FC<Omit<ConnectorProps, 'history'>> = (props) => {\n  const history = useHistory();\n  return <Connector history={history} {...props} />;\n};\n\nexport const Connector: FC<ConnectorProps> = ({ history, appName, ...props }) => {\n  const isSSR = typeof window === 'undefined';\n\n  // v6 or v5\n  const baseName = props.basename ?? '';\n\n  const onRedirectTo = useCallback((_path: string, opts?: RedirectOptions) => {\n    let path = _path;\n    // noinspection SuspiciousTypeOfGuard\n    if (baseName && typeof baseName === 'string' && baseName.length > 0 && path.startsWith(baseName)) {\n      path = path.substring(baseName.length);\n    }\n    if (opts?.preserveQueryParams) {\n      path = `${path}${window.location.search}`;\n    }\n    if (opts?.refresh && !isSSR) {\n      // @ts-ignore\n      window.Cypress ? history.push(path) : (window.location.href = path);\n    } else {\n      opts?.replace ? history.replace(path) : history.push(path);\n    }\n  }, []);\n\n  const app = useMemo(() => {\n    try {\n      return AppHolder.getInstance(appName ?? 'default');\n    } catch (e) {\n      return initialize(\n        {\n          ...props,\n          basename: props.basename ?? baseName,\n          contextOptions: {\n            requestCredentials: 'include',\n            ...props.contextOptions,\n          },\n          onRedirectTo,\n        },\n        appName ?? 'default'\n      );\n    }\n  }, []);\n  ContextHolder.setOnRedirectTo(onRedirectTo);\n\n  const signUpUrl = app.store.getState().auth.routes.signUpUrl;\n  useQueryKeeper({ routes: { signUpUrl }, history });\n\n  return <FronteggStoreProvider {...({ ...props, app } as any)} />;\n};\n\nexport const FronteggProvider: FC<FronteggProviderProps> = (props) => {\n  const history = useHistory();\n\n  if (props.history || history) {\n    return (\n      <Connector history={props.history || history} {...props}>\n        {props.children}\n      </Connector>\n    );\n  }\n\n  return (\n    <BrowserRouter basename={props.basename}>\n      <ConnectorHistory {...props}>{props.children}</ConnectorHistory>\n    </BrowserRouter>\n  );\n};\n","import React, { FC, ReactNode } from 'react';\nimport { useAuthUserOrNull } from '@frontegg/react-hooks';\n\nexport interface AuthorizationProps {\n  requiredRoles?: string[];\n  requiredPermissions?: string[];\n  render?: (isAuthorized: boolean) => React.ReactNode | null;\n  children?: ReactNode;\n}\n\nexport const AuthorizedContent: FC<AuthorizationProps> = (props) => {\n  let isAuthorized = true; // Initially\n  const user = useAuthUserOrNull();\n\n  if (!user?.superUser) {\n    if (props.requiredPermissions) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching permission\n      for (const permission of props.requiredPermissions) {\n        if (user?.permissions?.find(({ key }) => key === permission)) {\n          isAuthorized = true;\n        }\n      }\n    }\n\n    if (props.requiredRoles) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching role\n      for (const role of props.requiredRoles) {\n        if (user?.roles?.find(({ key }) => key === role)) {\n          isAuthorized = true;\n        }\n      }\n    }\n  }\n  if (typeof props.render === 'function') {\n    return <>{props.render(isAuthorized)}</>;\n  }\n\n  return isAuthorized ? <>{props.children}</> : null;\n};\n","import { useCallback, useMemo, useState } from 'react';\nimport { CheckoutDialog } from '@frontegg/admin-portal';\n\ninterface CheckoutDialogState {\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport interface CheckoutDialogHook {\n  showDialog: (plan: string) => void;\n  hideDialog: () => void;\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport const useCheckoutDialog = (appName = 'default'): CheckoutDialogHook => {\n  const [{ open, error, success }, setState] = useState<CheckoutDialogState>({\n    open: false,\n    error: null,\n    success: false,\n  });\n\n  const handleError = useCallback((error: string) => {\n    setState({\n      open: true,\n      success: false,\n      error,\n    });\n  }, []);\n\n  const handleSuccess = useCallback(() => {\n    setState({\n      open: false,\n      success: true,\n      error: null,\n    });\n  }, []);\n\n  const showDialog = useCallback(\n    (plan: string) => {\n      CheckoutDialog.show(\n        {\n          plan,\n          onClose: hideDialog,\n          onError: handleError,\n          onSuccess: handleSuccess,\n        },\n        appName\n      );\n      setState({\n        open: true,\n        success: false,\n        error: null,\n      });\n    },\n    [appName]\n  );\n\n  const hideDialog = useCallback(() => {\n    CheckoutDialog.hide(appName);\n    setState({\n      open: false,\n      error: null,\n      success: false,\n    });\n  }, [appName]);\n\n  return useMemo(\n    () => ({\n      open,\n      showDialog,\n      hideDialog,\n      error,\n      success,\n    }),\n    [open, showDialog, hideDialog, error, success]\n  );\n};\n"],"names":["ReactRouterDom.BrowserRouter","ReactRouterDom.useInRouterContext","ReactRouterDom.useNavigate","ReactRouterDom.useHistory","useRef","useLocation","useEffect","React","useCallback","useMemo","AppHolder","initialize","ContextHolder","FronteggStoreProvider","__assign","useAuthUserOrNull","useState","CheckoutDialog"],"mappings":"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"}