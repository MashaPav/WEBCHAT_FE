{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar tslib = require('tslib');\n\nvar React = require('react');\n\nvar React__default = _interopDefault(React);\n\nvar adminPortal = require('@frontegg/admin-portal');\n\nvar reactHooks = require('@frontegg/react-hooks');\n\nvar ReactRouterDom = require('react-router-dom');\n\nvar restApi = require('@frontegg/rest-api');\n\nvar AppHolder = require('@frontegg/admin-portal/AppHolder');\n\nvar types = require('@frontegg/types');\n\nvar BrowserRouter = ReactRouterDom.BrowserRouter;\n\nvar useHistory = function () {\n  var _a, _b, _c; // @ts-ignore\n\n\n  var navigate = ((_a = ReactRouterDom.useInRouterContext) === null || _a === void 0 ? void 0 : _a.call(ReactRouterDom)) ? (_b = ReactRouterDom.useNavigate) === null || _b === void 0 ? void 0 : _b.call(ReactRouterDom) : null;\n  var history = (_c = ReactRouterDom.useHistory) === null || _c === void 0 ? void 0 : _c.call(ReactRouterDom);\n\n  if (navigate) {\n    var push = function (path, state) {\n      if (state) {\n        navigate(path, {\n          state: state\n        });\n      } else {\n        navigate(path);\n      }\n    };\n\n    var replace = function (path, state) {\n      navigate(path, {\n        state: state,\n        replace: true\n      });\n    };\n\n    return {\n      push: push,\n      replace: replace\n    };\n  }\n\n  return history;\n};\n\nvar removeRedirectUrlFromQuery = function (query) {\n  var q = new URLSearchParams(query);\n  q.delete('redirectUrl');\n  return q.toString();\n};\n\nvar useQueryKeeper = function (_a) {\n  var routes = _a.routes,\n      history = _a.history;\n  var queryParams = React.useRef();\n  var prevPathname = React.useRef();\n\n  var _b = ReactRouterDom.useLocation(),\n      pathname = _b.pathname,\n      search = _b.search;\n\n  React.useEffect(function () {\n    if (!!search) {\n      queryParams.current = search;\n      prevPathname.current = pathname;\n    }\n  }, []);\n  React.useEffect(function () {\n    var shouldKeepQuery = !!Object.values(routes).find(function (route) {\n      return route === prevPathname.current;\n    });\n\n    if (!search && !!queryParams.current && shouldKeepQuery) {\n      var query = removeRedirectUrlFromQuery(queryParams.current);\n      history.push(pathname + (\"?\" + query));\n    }\n\n    prevPathname.current = pathname;\n  }, [pathname, search, routes]);\n};\n\nvar ConnectorHistory = function (props) {\n  var history = useHistory();\n  return React__default.createElement(Connector, tslib.__assign({\n    history: history\n  }, props));\n};\n\nvar Connector = function (_a) {\n  var _b;\n\n  var history = _a.history,\n      appName = _a.appName,\n      props = tslib.__rest(_a, [\"history\", \"appName\"]);\n\n  var isSSR = typeof window === 'undefined'; // v6 or v5\n\n  var baseName = (_b = props.basename) !== null && _b !== void 0 ? _b : '';\n  var onRedirectTo = React.useCallback(function (_path, opts) {\n    var path = _path; // noinspection SuspiciousTypeOfGuard\n\n    if (baseName && typeof baseName === 'string' && baseName.length > 0 && path.startsWith(baseName)) {\n      path = path.substring(baseName.length);\n    }\n\n    if (opts === null || opts === void 0 ? void 0 : opts.preserveQueryParams) {\n      path = \"\" + path + window.location.search;\n    }\n\n    if ((opts === null || opts === void 0 ? void 0 : opts.refresh) && !isSSR) {\n      // @ts-ignore\n      window.Cypress ? history.push(path) : window.location.href = path;\n    } else {\n      (opts === null || opts === void 0 ? void 0 : opts.replace) ? history.replace(path) : history.push(path);\n    }\n  }, []);\n  var app = React.useMemo(function () {\n    var _a;\n\n    try {\n      return AppHolder.AppHolder.getInstance(appName !== null && appName !== void 0 ? appName : 'default');\n    } catch (e) {\n      return adminPortal.initialize(tslib.__assign(tslib.__assign({}, props), {\n        basename: (_a = props.basename) !== null && _a !== void 0 ? _a : baseName,\n        contextOptions: tslib.__assign({\n          requestCredentials: 'include'\n        }, props.contextOptions),\n        onRedirectTo: onRedirectTo\n      }), appName !== null && appName !== void 0 ? appName : 'default');\n    }\n  }, []);\n  restApi.ContextHolder.setOnRedirectTo(onRedirectTo);\n  var signUpUrl = app.store.getState().auth.routes.signUpUrl;\n  useQueryKeeper({\n    routes: {\n      signUpUrl: signUpUrl\n    },\n    history: history\n  });\n  return React__default.createElement(reactHooks.FronteggStoreProvider, tslib.__assign({}, tslib.__assign(tslib.__assign({}, props), {\n    app: app\n  })));\n};\n\nvar FronteggProvider = function (props) {\n  var history = useHistory();\n\n  if (props.history || history) {\n    return React__default.createElement(Connector, tslib.__assign({\n      history: props.history || history\n    }, props), props.children);\n  }\n\n  return React__default.createElement(BrowserRouter, {\n    basename: props.basename\n  }, React__default.createElement(ConnectorHistory, tslib.__assign({}, props), props.children));\n};\n\nvar AuthorizedContent = function (props) {\n  var _a, _b;\n\n  var isAuthorized = true; // Initially\n\n  var user = reactHooks.useAuthUserOrNull();\n\n  if (!(user === null || user === void 0 ? void 0 : user.superUser)) {\n    if (props.requiredPermissions) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching permission\n\n      var _loop_1 = function (permission) {\n        if ((_a = user === null || user === void 0 ? void 0 : user.permissions) === null || _a === void 0 ? void 0 : _a.find(function (_a) {\n          var key = _a.key;\n          return key === permission;\n        })) {\n          isAuthorized = true;\n        }\n      };\n\n      for (var _i = 0, _c = props.requiredPermissions; _i < _c.length; _i++) {\n        var permission = _c[_i];\n\n        _loop_1(permission);\n      }\n    }\n\n    if (props.requiredRoles) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching role\n\n      var _loop_2 = function (role) {\n        if ((_b = user === null || user === void 0 ? void 0 : user.roles) === null || _b === void 0 ? void 0 : _b.find(function (_a) {\n          var key = _a.key;\n          return key === role;\n        })) {\n          isAuthorized = true;\n        }\n      };\n\n      for (var _d = 0, _e = props.requiredRoles; _d < _e.length; _d++) {\n        var role = _e[_d];\n\n        _loop_2(role);\n      }\n    }\n  }\n\n  if (typeof props.render === 'function') {\n    return React__default.createElement(React__default.Fragment, null, props.render(isAuthorized));\n  }\n\n  return isAuthorized ? React__default.createElement(React__default.Fragment, null, props.children) : null;\n};\n\nvar useCheckoutDialog = function (appName) {\n  if (appName === void 0) {\n    appName = 'default';\n  }\n\n  var _a = React.useState({\n    open: false,\n    error: null,\n    success: false\n  }),\n      _b = _a[0],\n      open = _b.open,\n      error = _b.error,\n      success = _b.success,\n      setState = _a[1];\n\n  var handleError = React.useCallback(function (error) {\n    setState({\n      open: true,\n      success: false,\n      error: error\n    });\n  }, []);\n  var handleSuccess = React.useCallback(function () {\n    setState({\n      open: false,\n      success: true,\n      error: null\n    });\n  }, []);\n  var showDialog = React.useCallback(function (plan) {\n    adminPortal.CheckoutDialog.show({\n      plan: plan,\n      onClose: hideDialog,\n      onError: handleError,\n      onSuccess: handleSuccess\n    }, appName);\n    setState({\n      open: true,\n      success: false,\n      error: null\n    });\n  }, [appName]);\n  var hideDialog = React.useCallback(function () {\n    adminPortal.CheckoutDialog.hide(appName);\n    setState({\n      open: false,\n      error: null,\n      success: false\n    });\n  }, [appName]);\n  return React.useMemo(function () {\n    return {\n      open: open,\n      showDialog: showDialog,\n      hideDialog: hideDialog,\n      error: error,\n      success: success\n    };\n  }, [open, showDialog, hideDialog, error, success]);\n};\n\nObject.keys(reactHooks).forEach(function (k) {\n  if (k !== 'default') Object.defineProperty(exports, k, {\n    enumerable: true,\n    get: function () {\n      return reactHooks[k];\n    }\n  });\n});\nObject.keys(types).forEach(function (k) {\n  if (k !== 'default') Object.defineProperty(exports, k, {\n    enumerable: true,\n    get: function () {\n      return types[k];\n    }\n  });\n});\nObject.defineProperty(exports, 'AdminPortal', {\n  enumerable: true,\n  get: function () {\n    return adminPortal.AdminPortal;\n  }\n});\nObject.defineProperty(exports, 'CheckoutDialog', {\n  enumerable: true,\n  get: function () {\n    return adminPortal.CheckoutDialog;\n  }\n});\nexports.AuthorizedContent = AuthorizedContent;\nexports.Connector = Connector;\nexports.ConnectorHistory = ConnectorHistory;\nexports.FronteggProvider = FronteggProvider;\nexports.useCheckoutDialog = useCheckoutDialog;","map":{"version":3,"sources":["../src/routerProxy.tsx","../src/queryKeeper.tsx","../src/FronteggProvider.tsx","../src/AuthorizedContent.tsx","../src/CheckoutDialog.tsx"],"names":["ReactRouterDom.BrowserRouter","ReactRouterDom.useNavigate","ReactRouterDom.useHistory","useRef","useLocation","useEffect","React","useCallback","useMemo","AppHolder","initialize","ContextHolder","FronteggStoreProvider","__assign","useAuthUserOrNull","useState","CheckoutDialog"],"mappings":"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","sourcesContent":["import * as ReactRouterDom from 'react-router-dom';\n\nexport type Path = string;\n\ntype Location = {\n  pathname: string;\n  search: string;\n  state: any;\n  hash: string;\n  key?: string;\n};\n\ntype LocationDescriptor = string | Location;\n\nexport type UseHistory = {\n  push(path: Path, state?: any): void;\n  push(location: LocationDescriptor): void;\n  replace(path: Path, state?: any): void;\n  replace(location: LocationDescriptor): void;\n};\n\nexport const BrowserRouter = ReactRouterDom.BrowserRouter;\n\nexport const useHistory = (): UseHistory => {\n  // @ts-ignore\n  const navigate = ReactRouterDom.useInRouterContext?.() ? ReactRouterDom.useNavigate?.() : null;\n  const history = ReactRouterDom.useHistory?.();\n\n  if (navigate) {\n    const push = (path: Path, state?: any): void => {\n      if (state) {\n        navigate(path, { state });\n      } else {\n        navigate(path);\n      }\n    };\n\n    const replace = (path: Path, state?: any): void => {\n      navigate(path, { state, replace: true });\n    };\n\n    return { push, replace };\n  }\n  return history;\n};\n","import { useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { UseHistory } from './routerProxy';\n\ninterface UseQueryKeeperProps {\n  history: UseHistory;\n  routes: {\n    [key: string]: string;\n  };\n}\n\nconst removeRedirectUrlFromQuery = (query: string) => {\n  const q = new URLSearchParams(query);\n  q.delete('redirectUrl');\n  return q.toString();\n};\n\nexport const useQueryKeeper = ({ routes, history }: UseQueryKeeperProps): void => {\n  const queryParams = useRef<string>();\n  const prevPathname = useRef<string>();\n  const { pathname, search } = useLocation();\n\n  useEffect(() => {\n    if (!!search) {\n      queryParams.current = search;\n      prevPathname.current = pathname;\n    }\n  }, []);\n\n  useEffect(() => {\n    const shouldKeepQuery = !!Object.values(routes).find((route) => route === prevPathname.current);\n\n    if (!search && !!queryParams.current && shouldKeepQuery) {\n      const query = removeRedirectUrlFromQuery(queryParams.current);\n      history.push(pathname + `?${query}`);\n    }\n\n    prevPathname.current = pathname;\n  }, [pathname, search, routes]);\n};\n","import React, { FC, ReactNode, useCallback, useMemo } from 'react';\nimport { initialize } from '@frontegg/admin-portal';\nimport { FronteggAppOptions } from '@frontegg/types';\nimport { FronteggStoreProvider } from '@frontegg/react-hooks';\nimport { BrowserRouter, useHistory, UseHistory } from './routerProxy';\nimport { ContextHolder, RedirectOptions } from '@frontegg/rest-api';\nimport { AppHolder } from '@frontegg/admin-portal/AppHolder';\nimport { useQueryKeeper } from './queryKeeper';\n\nexport type FronteggProviderProps = FronteggAppOptions & {\n  appName?: string;\n  history?: UseHistory;\n  children?: ReactNode;\n};\ntype ConnectorProps = Omit<FronteggProviderProps, 'history'> & {\n  history: {\n    push: (path: string) => void;\n    replace: (path: string) => void;\n  };\n};\n\nexport const ConnectorHistory: FC<Omit<ConnectorProps, 'history'>> = (props) => {\n  const history = useHistory();\n  return <Connector history={history} {...props} />;\n};\n\nexport const Connector: FC<ConnectorProps> = ({ history, appName, ...props }) => {\n  const isSSR = typeof window === 'undefined';\n\n  // v6 or v5\n  const baseName = props.basename ?? '';\n\n  const onRedirectTo = useCallback((_path: string, opts?: RedirectOptions) => {\n    let path = _path;\n    // noinspection SuspiciousTypeOfGuard\n    if (baseName && typeof baseName === 'string' && baseName.length > 0 && path.startsWith(baseName)) {\n      path = path.substring(baseName.length);\n    }\n    if (opts?.preserveQueryParams) {\n      path = `${path}${window.location.search}`;\n    }\n    if (opts?.refresh && !isSSR) {\n      // @ts-ignore\n      window.Cypress ? history.push(path) : (window.location.href = path);\n    } else {\n      opts?.replace ? history.replace(path) : history.push(path);\n    }\n  }, []);\n\n  const app = useMemo(() => {\n    try {\n      return AppHolder.getInstance(appName ?? 'default');\n    } catch (e) {\n      return initialize(\n        {\n          ...props,\n          basename: props.basename ?? baseName,\n          contextOptions: {\n            requestCredentials: 'include',\n            ...props.contextOptions,\n          },\n          onRedirectTo,\n        },\n        appName ?? 'default'\n      );\n    }\n  }, []);\n  ContextHolder.setOnRedirectTo(onRedirectTo);\n\n  const signUpUrl = app.store.getState().auth.routes.signUpUrl;\n  useQueryKeeper({ routes: { signUpUrl }, history });\n\n  return <FronteggStoreProvider {...({ ...props, app } as any)} />;\n};\n\nexport const FronteggProvider: FC<FronteggProviderProps> = (props) => {\n  const history = useHistory();\n\n  if (props.history || history) {\n    return (\n      <Connector history={props.history || history} {...props}>\n        {props.children}\n      </Connector>\n    );\n  }\n\n  return (\n    <BrowserRouter basename={props.basename}>\n      <ConnectorHistory {...props}>{props.children}</ConnectorHistory>\n    </BrowserRouter>\n  );\n};\n","import React, { FC, ReactNode } from 'react';\nimport { useAuthUserOrNull } from '@frontegg/react-hooks';\n\nexport interface AuthorizationProps {\n  requiredRoles?: string[];\n  requiredPermissions?: string[];\n  render?: (isAuthorized: boolean) => React.ReactNode | null;\n  children?: ReactNode;\n}\n\nexport const AuthorizedContent: FC<AuthorizationProps> = (props) => {\n  let isAuthorized = true; // Initially\n  const user = useAuthUserOrNull();\n\n  if (!user?.superUser) {\n    if (props.requiredPermissions) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching permission\n      for (const permission of props.requiredPermissions) {\n        if (user?.permissions?.find(({ key }) => key === permission)) {\n          isAuthorized = true;\n        }\n      }\n    }\n\n    if (props.requiredRoles) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching role\n      for (const role of props.requiredRoles) {\n        if (user?.roles?.find(({ key }) => key === role)) {\n          isAuthorized = true;\n        }\n      }\n    }\n  }\n  if (typeof props.render === 'function') {\n    return <>{props.render(isAuthorized)}</>;\n  }\n\n  return isAuthorized ? <>{props.children}</> : null;\n};\n","import { useCallback, useMemo, useState } from 'react';\nimport { CheckoutDialog } from '@frontegg/admin-portal';\n\ninterface CheckoutDialogState {\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport interface CheckoutDialogHook {\n  showDialog: (plan: string) => void;\n  hideDialog: () => void;\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport const useCheckoutDialog = (appName = 'default'): CheckoutDialogHook => {\n  const [{ open, error, success }, setState] = useState<CheckoutDialogState>({\n    open: false,\n    error: null,\n    success: false,\n  });\n\n  const handleError = useCallback((error: string) => {\n    setState({\n      open: true,\n      success: false,\n      error,\n    });\n  }, []);\n\n  const handleSuccess = useCallback(() => {\n    setState({\n      open: false,\n      success: true,\n      error: null,\n    });\n  }, []);\n\n  const showDialog = useCallback(\n    (plan: string) => {\n      CheckoutDialog.show(\n        {\n          plan,\n          onClose: hideDialog,\n          onError: handleError,\n          onSuccess: handleSuccess,\n        },\n        appName\n      );\n      setState({\n        open: true,\n        success: false,\n        error: null,\n      });\n    },\n    [appName]\n  );\n\n  const hideDialog = useCallback(() => {\n    CheckoutDialog.hide(appName);\n    setState({\n      open: false,\n      error: null,\n      success: false,\n    });\n  }, [appName]);\n\n  return useMemo(\n    () => ({\n      open,\n      showDialog,\n      hideDialog,\n      error,\n      success,\n    }),\n    [open, showDialog, hideDialog, error, success]\n  );\n};\n"]},"metadata":{},"sourceType":"script"}